// Expose scope because we are performing network and I/O operations
expose scope check_cert(host: clean str) -> signal {
    
    // Fetch certificate from host (untrusted network input)
    probe cert: untrusted payload = net.tls.get_cert(host)
    
    // Check if certificate was received
    scan cert.len == 0 { 
        return signal::fail  // Fail if no certificate
    }

    // Parse expiry date of certificate (clean, trusted after parsing)
    probe expiry: clean int = tls.parse_expiry(cert)
    
    // Check if certificate is expired
    scan expiry < fmt.timestamp() {
        log("[ALERT] Certificate expired for " + host)
    }

    // Get cipher used by certificate (clean, safe string)
    probe cipher: clean str = tls.get_cipher(cert)
    
    // Detect weak cipher suites
    scan cipher in ["RC4", "DES", "MD5"] {
        log("[WARNING] Weak cipher: " + cipher)
    }

    // Validate certificate chain
    scan tls.validate_chain(cert) == signal::fail {
        log("[ALERT] Invalid certificate chain for " + host)
    }

    // Audit log successful check
    log("[INFO] Cert check complete for " + host)

    // Return success signal
    return signal::ok
}

